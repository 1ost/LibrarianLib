<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>LibrarianLib</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="librarianlib.html"><strong aria-hidden="true">1.</strong> LibrarianLib</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="reading_kotlin.html"><strong aria-hidden="true">1.1.</strong> Reading Kotlin cheat sheet</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Foundation</li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> Foundation</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.</strong> Mod Setup</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.</strong> Registration</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">4.1.</strong> Items</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.2.</strong> Blocks</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.3.</strong> Tile Entities</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.4.</strong> Entities</div></li></ol></li><li class="chapter-item expanded "><li class="part-title">Facade</li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.</strong> Facade</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.</strong> Layers</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">6.1.</strong> What is a Layer</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.2.</strong> Transforms</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.3.</strong> Events</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.4.</strong> IMValue/RMValue</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.5.</strong> Self-layout</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.</strong> Input</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">7.1.</strong> mouseOver</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.2.</strong> Keyboard Input</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.</strong> Animation</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">8.1.</strong> Basics</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.2.</strong> Keyframes</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.3.</strong> Lerpers</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.</strong> Advanced topics</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">9.1.</strong> Clipping and Render to Texture</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.2.</strong> Opacity</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.3.</strong> Masks</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.4.</strong> Blend Modes</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.5.</strong> Tooltips</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.6.</strong> Yoga Layout</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">10.</strong> Containers</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">10.1.</strong> Woo boy…</div></li></ol></li><li class="chapter-item expanded "><li class="part-title">Other modules</li><li class="chapter-item expanded "><div><strong aria-hidden="true">11.</strong> Core</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">11.1.</strong> Useful Shit</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">11.2.</strong> Math?</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">12.</strong> Glitter</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">12.1.</strong> Systems</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">12.2.</strong> Bindings</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">12.3.</strong> Modules</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">13.</strong> Albedo</div></li><li class="chapter-item expanded "><a href="courier/index.html"><strong aria-hidden="true">14.</strong> Courier</a></li><li class="chapter-item expanded "><a href="etcetera/index.html"><strong aria-hidden="true">15.</strong> Etcetera</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="etcetera/event_bus.html"><strong aria-hidden="true">15.1.</strong> Event Bus</a></li><li class="chapter-item expanded "><a href="etcetera/raycasting.html"><strong aria-hidden="true">15.2.</strong> Raycasting</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">16.</strong> Mirage</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">17.</strong> Mosaic</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">17.1.</strong> Sprites</div></li></ol></li><li class="chapter-item expanded "><a href="prism/index.html"><strong aria-hidden="true">18.</strong> Prism</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="prism/refract_class.html"><strong aria-hidden="true">18.1.</strong> @RefractClass</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">18.2.</strong> Woo boy…</div></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">LibrarianLib</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#librarianlib" id="librarianlib">LibrarianLib</a></h1>
<p>LibrarianLib is a suite of libraries designed to help you express your creativity without having
to sweat the details. You don’t need to keep track of all the events that go into registering a
block, just hand it to LibLib, and we’ll take care of it for you.</p>
<p>LibrarianLib is fundamentally a Java library. The library itself may be written in Kotlin, but it
has been built with the focus on being clean and easy to use from Java code. If you encounter any
<a href="librarianlib.html#rough-apis">rough APIs</a>, please join <a href="https://discord.gg/KPaZHvq">our Discord server</a> and let me know. I do my
best to present a clean API, but some stuff inevitably slips through the cracks.</p>
<p>If you aren't familiar with Kotlin, don't worry. Kotlin is structurally almost identical to Java,
and I've written up a <a href="./reading_kotlin.html">quick guide</a> to help get you up to speed on reading
Kotlin.</p>
<h3><a class="header" href="#documentation-completeness" id="documentation-completeness">Documentation completeness</a></h3>
<p>LibrarianLib is rather large, and there's a lot of complex topics to document, so expect this
documentation to be very incomplete for quite a while. I'm going to write the documentation in a
tutorial style, with each module a self-contained unit that is expected to be read in order. </p>
<p>I try to make the APIs as obvious as I can and prioritize documentation comments for the most
confusing stuff, but there's only so much documentation I can take before I go crazy, sometimes
it's hard to tell from the inside what's confusing, and sometimes I just forget.</p>
<p>If you find any of the documentation (whether that be this guide or the documentation comments)
or APIs especially confusing please contact me (@thecodewarrior) on <a href="https://discord.gg/KPaZHvq">our Discord server</a>
so I can help clarify for you and learn how to improve the docs.</p>
<h3><a class="header" href="#rough-apis" id="rough-apis">Rough APIs</a></h3>
<p>Writing Kotlin code that's clean from the Java side, while easy most of the time, requires some
specific considerations. If you run into any rough APIs in LibrarianLib please tell me about them
<a href="https://discord.gg/KPaZHvq">on Discord</a> so I can resolve them.</p>
<p>Here are a few ways that the Kotlin–Java interface can go wrong:</p>
<ul>
<li>Needing to use <code>SomeClass.INSTANCE.*</code><br />
(this means I forgot to add <code>@JvmStatic</code>)</li>
<li>Needing to use <code>SomeClass.Companion.INSTANCE.*</code><br />
(this means I forgot to add <code>@JvmStatic</code>)</li>
<li>Needing to use a class called <code>SomeNameKt</code><br />
(this means I forgot to set the <code>@JvmName</code> of the file)</li>
<li>Getters for &quot;constant&quot; values, like <code>SomeClass.getSOME_CONSTANT()</code><br />
(this means I forgot to add <code>@JvmField</code> or need to rename it to use <code>camelCase</code>)</li>
<li>A public method that accepts a Kotlin <code>Function1</code>/<code>Function2</code>/etc.<br />
(this means I forgot to use a Java functional interface instead of a Kotlin function type)</li>
<li><em>Both</em> a public method that accepts a <code>Consumer</code>/<code>Supplier</code>/etc. <em>and</em> one that accepts a Kotlin
<code>Function1</code>/<code>Function2</code>/etc.<br />
(there are some cases this is used, and it means I forgot to mark the Kotlin one as 
<code>@JvmSynthetic</code>)</li>
<li>A public method with a <code>$</code> in the name, like <code>someMethod$librarianlib</code><br />
(this means I forgot to add <code>@JvmSynthetic</code> to an internal member)</li>
</ul>
<p>If you ever run across an API that seems… &quot;funky&quot; from a java perspective, ask about it! There's a </p>
<h1><a class="header" href="#reading-kotlin-cheat-sheet" id="reading-kotlin-cheat-sheet">Reading Kotlin cheat sheet</a></h1>
<p>TODO &gt;.&lt;</p>
<h1><a class="header" href="#courier" id="courier">Courier</a></h1>
<p>Courier is LibrarianLib's network library. Courier is designed to solve some usability problems with 
Forge packets, specifically the fact that serialization can be a pain and the Forge API encourages
chucking all your packet implementations into one <a href="https://en.wikipedia.org/wiki/God_object">god method</a>.</p>
<p>Networking in Minecraft is done using “packets”, and those packets are sent on “channels.” A 
channel is like a radio channel, and packets are like the audio signal being sent on that channel.</p>
<h2><a class="header" href="#channels" id="channels">Channels</a></h2>
<p>Creating a channel is simple. All you need to do is create a new <code>CourierChannel</code> object with a
channel ID and protocol version. The protocol version is used to check for client/server 
compatibility. By default, mods require identical versions on the client and server, so unless 
you're doing something special on that front this can be a static value.</p>
<pre><code class="language-java">public static final CourierChannel channel = new CourierChannel(
    new ResourceLocation(&quot;your_mod:network&quot;), &quot;0&quot;
);
</code></pre>
<h2><a class="header" href="#packets" id="packets">Packets</a></h2>
<p>Networking is hard, so there are a few things you need to keep in mind when using packets. </p>
<p>First, packets are handled on a separate network thread. This means you can <em>not</em> interact with most
of the game directly in your packet handler. If you want to interact with the game you need to put
all that interaction inside a <code>context.enqueueWork(() -&gt; {})</code>, which will call the given <code>Runnable</code>
on the main thread at the next opportunity.</p>
<p>Second, <strong>NEVER EVER EVER</strong> trust the client. Always assume the player is using a hacked client, and
program accordingly. Validate everything. If possible, compute things server-side instead of sending
them from the client. (e.g. compute the block they're looking at on the server instead of the client
sending the block in the packet. If the client can send the block they could do things through walls
or even from across the world. If you have a “fire spell” packet with a “charge” value that ranges
from 0 to 1, make sure it's <em>actually</em> between 0 and 1, otherwise a hacked client could casually 
send a packet with a charge of 500 and suddenly be able to fire a spell at 50,000% strength.)</p>
<p>Third, fourth, fifth, and sixth: <em><strong>NEVER TRUST THE CLIENT.</strong></em> The examples on this page include 
some basic validation, but you should always be thinking about ways people could hack their clients.</p>
<p>Networking is <em>hard.</em> Be careful.</p>
<h2><a class="header" href="#creating-manual-packets" id="creating-manual-packets">Creating manual packets</a></h2>
<p>Once you've created your channel, it's time to register your packet. Whereas Forge uses callbacks
for serialization and handling, LibLib uses <code>PacketType</code> objects. Courier provides a system for 
automatic packet serialization, but I'll first cover entirely custom packets, since they're simpler,
if more manual.</p>
<pre><code class="language-java"><span class="boring">import com.teamwizardry.librarianlib.core.util.Client;
</span><span class="boring">import com.teamwizardry.librarianlib.core.util.sided.SidedSupplier;
</span><span class="boring">import com.teamwizardry.librarianlib.courier.PacketType;
</span><span class="boring">import net.minecraft.block.Block;
</span><span class="boring">import net.minecraft.entity.player.PlayerEntity;
</span><span class="boring">import net.minecraft.network.PacketBuffer;
</span><span class="boring">import net.minecraft.util.math.BlockPos;
</span><span class="boring">import net.minecraftforge.fml.network.NetworkDirection;
</span><span class="boring">import net.minecraftforge.fml.network.NetworkEvent;
</span><span class="boring">import org.jetbrains.annotations.NotNull;
</span><span class="boring">
</span><span class="boring">import java.util.function.Supplier;
</span><span class="boring">
</span>public class YourPacketType extends PacketType&lt;YourPacketType.Packet&gt; {
    public YourPacketType() {
        super(Packet.class);
    }

    // The actual packet
    public static class Packet {
        public final BlockPos pos;
        public final Block block;

        public Packet(BlockPos pos, Block block) {
            this.pos = pos;
            this.block = block;
        }
    }

    @Override
    public void encode(Packet packet, @NotNull PacketBuffer buffer) {
        buffer.writeBlockPos(packet.pos);
        buffer.writeRegistryId(packet.block);
    }

    @Override
    public Packet decode(@NotNull PacketBuffer buffer) {
        BlockPos pos = buffer.readBlockPos();
        Block block = buffer.readRegistryIdSafe(Block.class);
        return new Packet(pos, block);
    }

    @Override
    public void handle(Packet packet, @NotNull Supplier&lt;NetworkEvent.Context&gt; context) {
        PlayerEntity player;
        if (context.get().getDirection() == NetworkDirection.PLAY_TO_CLIENT) {
            // we can use client-only code in this block
            player = SidedSupplier.client(() -&gt; Client.getPlayer());
        } else {
            player = context.get().getSender();
        }

        // run
        context.get().enqueueWork(() -&gt; {
            // **NEVER** trust the client. If we don't do this it would allow a 
            // hacked client to generate and load arbitrary chunks.
            if (!player.world.isBlockLoaded(packet.pos)) {
                return;
            }
            if (player.world.getBlockState(packet.pos).getBlock() != packet.block) {
                // do something
            }
        });
    }
}
</code></pre>
<p>Once you've got your packet type, just call <code>channel.register(new YourPacketType())</code>. If you want
to limit the direction the packet is sent, you can add a <code>NetworkDirection</code> to that method, making 
it <code>channel.register(new YourPacketType(), NetworkDirection.PLAY_TO_SERVER)</code>.</p>
<h2><a class="header" href="#creating-prism-packets" id="creating-prism-packets">Creating prism packets</a></h2>
<p>You can also use the <a href="courier/../prism/README.html">Prism</a> module to automatically serialize your packets. To
take advantage of this you need to implement <code>CourierPacket</code> and <a href="courier/../prism/refract_class.html">make it serializable</a>. </p>
<pre><code class="language-java"><span class="boring">import com.teamwizardry.librarianlib.core.util.Client;
</span><span class="boring">import com.teamwizardry.librarianlib.core.util.sided.SidedSupplier;
</span><span class="boring">import com.teamwizardry.librarianlib.courier.CourierPacket;
</span><span class="boring">import dev.thecodewarrior.prism.annotation.Refract;
</span><span class="boring">import dev.thecodewarrior.prism.annotation.RefractClass;
</span><span class="boring">import dev.thecodewarrior.prism.annotation.RefractConstructor;
</span><span class="boring">import net.minecraft.block.Block;
</span><span class="boring">import net.minecraft.entity.player.PlayerEntity;
</span><span class="boring">import net.minecraft.network.PacketBuffer;
</span><span class="boring">import net.minecraft.util.math.BlockPos;
</span><span class="boring">import net.minecraftforge.fml.network.NetworkDirection;
</span><span class="boring">import net.minecraftforge.fml.network.NetworkEvent;
</span><span class="boring">import org.jetbrains.annotations.NotNull;
</span><span class="boring">
</span>@RefractClass
public class YourCourierPacket implements CourierPacket {
    @Refract
    public final BlockPos pos;
    @Refract
    public final Block block;

    // parameter types and names match fields
    @RefractConstructor
    public YourCourierPacket(BlockPos pos, Block block) {
        this.pos = pos;
        this.block = block;
    }

    // optionally write anything not supported by Prism.
    @Override
    public void writeBytes(@NotNull PacketBuffer buffer) {
    }

    // optionally read anything not supported by Prism.
    // you'll need to use a non-final field and initialize it in this method.
    @Override
    public void readBytes(@NotNull PacketBuffer buffer) {
    }

    @Override
    public void handle(@NotNull NetworkEvent.Context context) {
        PlayerEntity player;
        if (context.getDirection() == NetworkDirection.PLAY_TO_CLIENT) {
            // we can use client-only code in this block
            player = SidedSupplier.client(() -&gt; Client.getPlayer());
        } else {
            player = context.getSender();
        }

        // run
        context.enqueueWork(() -&gt; {
            // **NEVER** trust the client. If we don't do this
            // it would allow a hacked client to generate and load
            // arbitrary chunks.
            if (!player.world.isBlockLoaded(this.pos)) {
                return;
            }
            if (player.world.getBlockState(this.pos).getBlock() != this.block) {
                // do something
            }
        });
    }
}
</code></pre>
<p>Once you've got your courier packet class, just call <code>channel.registerCourierPacket(YourCourierPacket.class)</code>. 
You can optionally give it a <code>NetworkDirection</code> to limit the direction the packet is sent and a 
<code>BiConsumer</code> for any inline processing you want to do.</p>
<h2><a class="header" href="#sending-packets" id="sending-packets">Sending packets</a></h2>
<p>To send a packet all you have to do is call <code>channel.send(target, packetInstance)</code>. The only 
complex part here is the packet target, so I'll go over them briefly.</p>
<ul>
<li><code>PacketDistributor.SERVER.noArg()</code><br />
The simplest target, <code>SERVER</code> sends a packet from the client to the server. This is the 
<em>only</em> target that's usable on the client, and it isn't usable on the server.</li>
<li><code>PacketDistributor.ALL.noArg()</code><br />
The simplest server-side target, <code>ALL</code> sends a packet to every connected client.</li>
<li><code>PacketDistributor.PLAYER.with(() -&gt; thePlayer)</code><br />
Sends a packet directly to the supplied player.</li>
<li><code>PacketDistributor.DIMENSION.with(() -&gt; theDimensionType)</code><br />
Sends a packet to all the players in the supplied dimension.</li>
<li><code>PacketDistributor.NEAR.with(() -&gt; targetPoint)</code><br />
Sends a packet to every player near the supplied point <code>TargetPoint</code>. A <code>TargetPoint</code> consists
of a dimension, xyz coordinates, radius, and optionally an &quot;excluded&quot; player, which won't be sent
the packet. The excluded player is useful if the packet is related to one player and you only 
need to send packets to everyone else.</li>
<li><code>PacketDistributor.TRACKING_ENTITY.with(() -&gt; theEntity)</code><br />
Sends a packet to every player that is currently tracking the supplied entity. If the supplied 
entity is a player, this will <em>not</em> send the packet to that player. If you need that, use the
next target.</li>
<li><code>PacketDistributor.TRACKING_ENTITY_AND_SELF.with(() -&gt; theEntity)</code><br />
Sends a packet to every player that is currently tracking the supplied entity. If the supplied 
entity is a player, this will send the packet to that player as well.</li>
<li><code>PacketDistributor.NMLIST.with(() -&gt; theNetworkManagers)</code><br />
You will almost never need this one. Sends the packet directly to the supplied <code>NetworkManager</code>s
(you can get a player's network manager using <code>serverPlayer.connection.getNetworkManager()</code>).</li>
</ul>
<h2><a class="header" href="#replying-to-packets" id="replying-to-packets">Replying to packets</a></h2>
<p>If you want to reply to a packet you just received, just pass the packet you would like to send and
the network context to <code>channel.reply(packet, context)</code>.</p>
<h1><a class="header" href="#etcetera" id="etcetera">Etcetera</a></h1>
<p>Etcetera is somewhat of a hodgepodge of tools. It's a mixture of tools used for specific modules
that are useful in their own, and minor utilities that don't fit well in <a href="etcetera/../core/README.html">core</a>.</p>
<h1><a class="header" href="#event-bus" id="event-bus">Event Bus</a></h1>
<p>Etcetera provides a basic event bus with a reflection-based hooking system a la
<code>@SubscribeEvent</code>. This system was originally created for <a href="etcetera/../facade/README.html">Facade</a>.</p>
<p>First, some terminology. <strong>Events</strong> are fired on an <strong>event bus</strong>. Other code can then <strong>hook</strong>
into that event type on that bus. Events can then be <strong>fired</strong> on that event bus and the bus will
run all the hooks registered for that event type, passing the event object to each one in
succession.</p>
<h2><a class="header" href="#event-bus-1" id="event-bus-1">Event Bus</a></h2>
<p>Creating an event bus just requires creating an <code>EventBus</code> object.</p>
<pre><code class="language-java"><span class="boring">import com.teamwizardry.librarianlib.etcetera.eventbus.EventBus;
</span><span class="boring">
</span><span class="boring">public class ThingWithEvents {
</span>    public final EventBus BUS = new EventBus();
<span class="boring">}
</span></code></pre>
<h2><a class="header" href="#events" id="events">Events</a></h2>
<p>Events come in two flavors, cancelable and non-cancelable. I'll be covering the non-cancelable
events first since cancelable events just build on top of them.</p>
<p>Events typically have fields that hold details about what happened (e.g. what mouse button was
clicked). These are typically <code>final</code> fields, since events shouldn't be changing them. Some
events want something from the hooks (e.g. allowing event hooks to constrain a value before it's
used), so they will have non-final fields that the hooks can modify. The data from the event
object will then be read after firing it.</p>
<h3><a class="header" href="#simple-events" id="simple-events">Simple events</a></h3>
<p>Simple events are, well, simple. The only thing you need to do to create your own event is
subclass <code>Event</code>.</p>
<pre><code class="language-java"><span class="boring">import com.teamwizardry.librarianlib.etcetera.eventbus.Event;
</span><span class="boring">
</span>public class ExampleEvent extends Event {
    public final int action;

    public ExampleEvent(int action) {
        this.action = action;
    }
}
</code></pre>
<h3><a class="header" href="#cancelable-events" id="cancelable-events">Cancelable events</a></h3>
<p>Cancelable events are virtually identical to plain events, except that they have a <code>cancel()</code>
method that will stop any further processing of the event (unless they request otherwise. I'll
get into that) and the code firing the event may interpret the event being canceled in some special way.</p>
<pre><code class="language-java"><span class="boring">import com.teamwizardry.librarianlib.etcetera.eventbus.CancelableEvent;
</span><span class="boring">
</span>public class ExampleCancelableEvent extends CancelableEvent {
    public final int action;

    public ExampleCancelableEvent(int action) {
        this.action = action;
    }
}
</code></pre>
<h2><a class="header" href="#hooks" id="hooks">Hooks</a></h2>
<p>Hooks into events can be made one of two ways. Either by manually calling the <code>hook</code> method on
the bus or by annotating a method with <code>@Hook</code> and passing an instance to the <code>register</code> method on 
the bus. Note that there's no way to use <code>@Hook</code> on static methods.</p>
<p>These two blocks are functionally equivalent:</p>
<pre><code class="language-java"><span class="boring">public class ExampleHooks {
</span>    public void manualHook() {
        BUS.hook(ExampleEvent.class, (ExampleEvent e) -&gt; {
            // run code here
        });
    }
<span class="boring">}
</span></code></pre>
<pre><code class="language-java"><span class="boring">import com.teamwizardry.librarianlib.etcetera.eventbus.Hook;
</span><span class="boring">
</span><span class="boring">public class ExampleHooks {
</span>    public void autoHook() {
        BUS.register(this);
    }

    // hook methods don't need to be public
    @Hook
    private void example(ExampleEvent e) {
        // run code here
    }
<span class="boring">}
</span></code></pre>
<h2><a class="header" href="#advanced-eventshooks" id="advanced-eventshooks">Advanced events/hooks</a></h2>
<h3><a class="header" href="#hook-options" id="hook-options">Hook options</a></h3>
<p>Similarly to Forge event hooks, Etcetera event hooks can have a priority and can request to still 
receive canceled events. The priority and <code>receiveCanceled</code> flag can be passed to the <code>hook</code> method
or in the <code>@Hook</code> annotation, as the case may be. The priority is useful for canceling events, since
you can request for your event to run before others. The priorities are, in the order they're run, 
<code>FIRST</code>, <code>EARLY</code>, <code>DEFAULT</code>, <code>LATE</code>, <code>LAST</code>.</p>
<h3><a class="header" href="#per-hook-state" id="per-hook-state">Per-hook state</a></h3>
<p>Individual event hooks can hold some state, and your event can act on that by overriding the
<code>storePerHookState</code> and <code>loadPerHookState</code> methods. Whatever value was returned from
<code>storePerHookState</code> is passed to <code>loadPerHookState</code> the next time <em>that hook</em> is called, meaning
each individual hook can have independent state.</p>
<pre><code class="language-java"><span class="boring">import com.teamwizardry.librarianlib.etcetera.eventbus.Event;
</span><span class="boring">import org.jetbrains.annotations.Nullable;
</span><span class="boring">
</span>public class ExampleEventState extends Event {
    public final int delta;
    public int accumulator;

    public ExampleEventState(int delta) {
        this.delta = delta;
    }

    @Override
    protected void loadPerHookState(@Nullable Object state) {
        if(state != null) {
            accumulator = (Integer)state;
        } else {
            accumulator = 0;
        }
        accumulator += delta;
    }

    @Nullable
    @Override
    protected Object storePerHookState() {
        return accumulator;
    }
}
</code></pre>
<pre><code class="language-java"><span class="boring">import com.teamwizardry.librarianlib.etcetera.eventbus.Hook;
</span><span class="boring">
</span><span class="boring">public class ExampleHooks {
</span><span class="boring">    public void autoHook() {
</span><span class="boring">        BUS.register(this);
</span><span class="boring">    }
</span><span class="boring">
</span>    // this will run every 100 &quot;units&quot; of delta. This is useful for mouse
    // scroll events, where lots of little deltas should add up to one step
    @Hook
    private void example(ExampleEventState e) {
        while(e.accumulator &gt;= 100) {
            e.accumulator -= 100;
            // do the thing
        }
    }
<span class="boring">}
</span></code></pre>
<h1><a class="header" href="#raycasting" id="raycasting">Raycasting</a></h1>
<p>Etcetera provides highly optimized <code>Raycaster</code> class, which is designed to reduce the number of
short-lived objects and improve the performance of long raycasts. In order to avoid unnecessary
object allocation, the <code>Raycaster</code> object contains fields for the hit result, in contrast to
Minecraft's function, which returns a <code>RayTraceResult</code> object (and creates possibly <em>hundreds</em> of
temporary objects along the way).</p>
<h2><a class="header" href="#casting-rays" id="casting-rays">Casting rays</a></h2>
<p>When appropriate, you should reuse a single <code>Raycaster</code> instance, and after you're done with the
hit result you should <em>always</em> call <code>reset()</code>. While the <code>Raycaster</code> class is very lightweight,
unnecessarily creating new instances somewhat defeats the minimal object allocation aspect of it.
Calling <code>reset()</code> is <em>vitally</em> important. When performing a raycast the result will be discarded
if it's farther away than the current result. This both simplifies the internal implementation
and allows you to combine the results of multiple raycasts with different settings.</p>
<p>In the interest of brevity these examples will use temporary objects (e.g. <code>Vec3d</code>), however if
you're writing performance-critical code you should avoid these and use primitive variables.</p>
<h3><a class="header" href="#basic-raycasting" id="basic-raycasting">Basic raycasting</a></h3>
<pre><code class="language-java"><span class="boring">import com.teamwizardry.librarianlib.etcetera.Raycaster;
</span><span class="boring">import net.minecraft.entity.Entity;
</span><span class="boring">import net.minecraft.util.math.BlockPos;
</span><span class="boring">import net.minecraft.util.math.Vec3d;
</span><span class="boring">import org.jetbrains.annotations.Nullable;
</span><span class="boring">
</span><span class="boring">public class BasicRaycastExample {
</span>    // note: Raycaster is *not* thread-safe, though world should only be 
    // accessed from the main thread anyway.
    private static Raycaster raycaster = new Raycaster();

    @Nullable
    public BlockPos basicBlockRaycast(Entity entity) {
        Vec3d start = entity.getEyePosition(0);
        Vec3d look = entity.getLookVec();

        // cast the ray
        raycaster.cast(entity.getEntityWorld(), Raycaster.BlockMode.VISUAL,
                start.getX(), start.getY(), start.getZ(),
                start.getX() + look.getX() * 100,
                start.getY() + look.getY() * 100,
                start.getZ() + look.getZ() * 100
        );

        // get the result out of it
        BlockPos result = null;
        if (raycaster.getHitType() == Raycaster.HitType.BLOCK) {
            result = new BlockPos(
                    raycaster.getBlockX(),
                    raycaster.getBlockY(),
                    raycaster.getBlockZ()
            );
        }

        // it is VITALLY important that you do this
        raycaster.reset();
        return result;
    }
<span class="boring">}
</span></code></pre>
<h3><a class="header" href="#advanced-raycasting" id="advanced-raycasting">Advanced raycasting</a></h3>
<p>While <code>Raycaster</code> has a convenience method for raycasting blocks, it can also cast against fluid or
entities using the full <code>cast</code> method.</p>
<pre><code class="language-java"><span class="boring">import com.teamwizardry.librarianlib.etcetera.Raycaster;
</span><span class="boring">import net.minecraft.entity.Entity;
</span><span class="boring">import net.minecraft.entity.player.PlayerEntity;
</span><span class="boring">import net.minecraft.util.math.BlockPos;
</span><span class="boring">import net.minecraft.util.math.Vec3d;
</span><span class="boring">
</span><span class="boring">import java.util.function.Predicate;
</span><span class="boring">
</span><span class="boring">public class AdvancedRaycastExample {
</span>    // note: Raycaster is *not* thread-safe, though world should only be 
    // accessed from the main thread anyway.
    private static Raycaster raycaster = new Raycaster();
    private static Predicate&lt;Entity&gt; isPlayerPredicate = 
            (entity) -&gt; entity instanceof PlayerEntity;


    public void advancedRaycast(Entity entity) {
        double rayLength = 100;
        Vec3d start = entity.getEyePosition(0);
        Vec3d look = entity.getLookVec();
        look = new Vec3d(
                look.getX() * rayLength,
                look.getY() * rayLength,
                look.getZ() * rayLength
        );

        // cast the ray
        raycaster.cast(entity.getEntityWorld(),
                Raycaster.BlockMode.VISUAL,
                Raycaster.FluidMode.SOURCE,
                isPlayerPredicate,
                start.getX(), start.getY(), start.getZ(),
                start.getX() + look.getX(),
                start.getY() + look.getY(),
                start.getZ() + look.getZ()
        );

        // get the result out of it

        if(raycaster.getHitType() == Raycaster.HitType.NONE) {
            return;
        }

        // the fraction along the raycast that the hit occurred
        double distance = raycaster.getFraction() * rayLength;

        // normal and hit position apply to all the hit types
        Vec3d normal = new Vec3d(
                raycaster.getNormalX(),
                raycaster.getNormalY(),
                raycaster.getNormalZ()
        );
        Vec3d hitPos = new Vec3d(
                raycaster.getHitX(),
                raycaster.getHitY(),
                raycaster.getHitZ()
        );

        switch (raycaster.getHitType()) {
            // block and fluid hits both have block positions
            case BLOCK:
            case FLUID:
                BlockPos hitBlock = new BlockPos(
                        raycaster.getBlockX(),
                        raycaster.getBlockY(),
                        raycaster.getBlockZ()
                );
                break;
            // entity hits have the entity that was hit
            case ENTITY:
                Entity hitEntity = raycaster.getEntity();
                break;
        }

        // it is VITALLY important that you do this
        raycaster.reset();
    }
<span class="boring">}
</span></code></pre>
<h1><a class="header" href="#prism" id="prism">Prism</a></h1>
<p>Prism is LibrarianLib's automatic serialization library, and it's a very deep subject. A guide will 
happen in the future, however it isn't written yet.</p>
<h1><a class="header" href="#refractclass" id="refractclass"><code>@RefractClass</code></a></h1>
<p>Okay, this is a really deep subject that I'm not going to fully document at the moment, however I'll
give some pointers.</p>
<ul>
<li><code>@RefractClass</code><br />
Annotate your class with this to tell Prism that you want it to go through automatic 
serialization.</li>
<li><code>@Refract</code><br />
Annotate your field with this to mark it for automatic serialization.</li>
<li><code>@RefractGetter</code>/<code>@RefractSetter</code><br />
Annotate your getters and setters with this to mark them for automatic serialization. A getter 
with no setter is treated similarly to a final field.</li>
<li><code>@RefractConstructor</code><br />
If you want Prism to be able to create instances from scratch (necessary if there are final 
<code>@Refract</code> fields), create a constructor with parameters that have identical names and types to
all your <code>@Refract</code> fields. (You <em>need</em> to compile with parameter names here. Add <code>-parameters</code> to
the Java compiler options or <code>-java-parameters</code> to the Kotlin compiler options)</li>
<li><code>@RefractUpdateTest</code><br />
A somewhat technical annotation which influences the creation of new instances.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        
        <!-- Livereload script (if served using the cli tool) -->
        <script type="text/javascript">
            var socket = new WebSocket("ws://localhost:3000/__livereload");
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>
        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
