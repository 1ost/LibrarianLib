<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Event Bus - LibrarianLib</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../favicon.svg">
        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        
        <link rel="stylesheet" href="../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../librarianlib.html"><strong aria-hidden="true">1.</strong> LibrarianLib</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reading_kotlin.html"><strong aria-hidden="true">1.1.</strong> Reading Kotlin cheat sheet</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Foundation</li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.</strong> Foundation</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.</strong> Mod Setup</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.</strong> Registration</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">4.1.</strong> Items</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.2.</strong> Blocks</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.3.</strong> Tile Entities</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.4.</strong> Entities</div></li></ol></li><li class="chapter-item expanded "><li class="part-title">Facade</li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.</strong> Facade</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.</strong> Layers</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">6.1.</strong> What is a Layer</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.2.</strong> Transforms</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.3.</strong> Events</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.4.</strong> IMValue/RMValue</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.5.</strong> Self-layout</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.</strong> Input</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">7.1.</strong> mouseOver</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">7.2.</strong> Keyboard Input</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.</strong> Animation</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">8.1.</strong> Basics</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.2.</strong> Keyframes</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">8.3.</strong> Lerpers</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.</strong> Advanced topics</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">9.1.</strong> Clipping and Render to Texture</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.2.</strong> Opacity</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.3.</strong> Masks</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.4.</strong> Blend Modes</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.5.</strong> Tooltips</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.6.</strong> Yoga Layout</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">10.</strong> Containers</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">10.1.</strong> Woo boy…</div></li></ol></li><li class="chapter-item expanded "><li class="part-title">Other modules</li><li class="chapter-item expanded "><div><strong aria-hidden="true">11.</strong> Core</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">11.1.</strong> Useful Shit</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">11.2.</strong> Math?</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">12.</strong> Glitter</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">12.1.</strong> Systems</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">12.2.</strong> Bindings</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">12.3.</strong> Modules</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">13.</strong> Albedo</div></li><li class="chapter-item expanded "><a href="../courier/index.html"><strong aria-hidden="true">14.</strong> Courier</a></li><li class="chapter-item expanded "><a href="../etcetera/index.html"><strong aria-hidden="true">15.</strong> Etcetera</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../etcetera/event_bus.html" class="active"><strong aria-hidden="true">15.1.</strong> Event Bus</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">15.2.</strong> Raycasting</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">15.3.</strong> Stencil mask</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">16.</strong> Mirage</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">17.</strong> Mosaic</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">17.1.</strong> Sprites</div></li></ol></li><li class="chapter-item expanded "><a href="../prism/index.html"><strong aria-hidden="true">18.</strong> Prism</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../prism/refract_class.html"><strong aria-hidden="true">18.1.</strong> @RefractClass</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">18.2.</strong> Woo boy…</div></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">LibrarianLib</h1>

                    <div class="right-buttons">
                        
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#event-bus" id="event-bus">Event Bus</a></h1>
<p>Etcetera provides a basic event bus with a reflection-based hooking system a la
<code>@SubscribeEvent</code>. This system was originally created for <a href="../facade/README.html">Facade</a>.</p>
<p>First, some terminology. <strong>Events</strong> are fired on an <strong>event bus</strong>. Other code can then <strong>hook</strong>
into that event type on that bus. Events can then be <strong>fired</strong> on that event bus and the bus will
run all of the hooks registered for that event type, passing the event object to each one in
succession.</p>
<h2><a class="header" href="#event-bus-1" id="event-bus-1">Event Bus</a></h2>
<p>Creating an event bus just requires creating an <code>EventBus</code> object.</p>
<pre><code class="language-java"><span class="boring">import com.teamwizardry.librarianlib.etcetera.eventbus.EventBus;
</span><span class="boring">
</span><span class="boring">public class ExampleBus {
</span>    public final EventBus BUS = new EventBus();
<span class="boring">}
</span></code></pre>
<h2><a class="header" href="#events" id="events">Events</a></h2>
<p>Events come in two flavors, cancelable and non-cancelable. I'll be covering the non-cancelable
events first since cancelable events just build on top of them.</p>
<p>Events typically have fields that hold details about what happened (e.g. what mouse button was
clicked). These are typically <code>final</code> fields, since events shouldn't be changing them. Some
events want something from the hooks (e.g. allowing event hooks to constrain a value before it's
used), so they will have non-final fields that the hooks can modify. The data from the event
object will then be read after firing it.</p>
<h3><a class="header" href="#simple-events" id="simple-events">Simple events</a></h3>
<p>Simple events are, well, simple. However, they have a few tricks up their sleeve. The only thing
you need to do to create your own event is subclass <code>Event</code>.</p>
<pre><code class="language-java"><span class="boring">import com.teamwizardry.librarianlib.etcetera.eventbus.Event;
</span><span class="boring">
</span>public class ExampleEvent extends Event {
    public final int action;

    public ExampleEvent(int action) {
        this.action = action;
    }
}
</code></pre>
<h3><a class="header" href="#cancelable-events" id="cancelable-events">Cancelable events</a></h3>
<p>Cancelable events are virtually identical to plain events, except that they have a <code>cancel()</code>
method that will stop any further processing of the event (unless they request otherwise. I'll
get into that) and the code firing the event may interpret the event being canceled in some special way.</p>
<pre><code class="language-java"><span class="boring">import com.teamwizardry.librarianlib.etcetera.eventbus.CancelableEvent;
</span><span class="boring">
</span>public class ExampleCancelableEvent extends CancelableEvent {
    public final int action;

    public ExampleCancelableEvent(int action) {
        this.action = action;
    }
}
</code></pre>
<h2><a class="header" href="#hooks" id="hooks">Hooks</a></h2>
<p>Hooks into events can be made one of two ways. Either by manually calling the <code>hook</code> method on
the bus or by annotating a method with <code>@Hook</code> and calling the <code>register</code> method on the bus.</p>
<p>These two blocks are functionally equivalent:</p>
<pre><code class="language-java"><span class="boring">public class ExampleHooks {
</span>    public void manualHook() {
        BUS.hook(ExampleEvent.class, (ExampleEvent e) -&gt; {
            // run code here
        });
    }
<span class="boring">}
</span></code></pre>
<pre><code class="language-java"><span class="boring">import com.teamwizardry.librarianlib.etcetera.eventbus.Hook;
</span><span class="boring">
</span><span class="boring">public class ExampleHooks {
</span>    public void autoHook() {
        BUS.register(this);
    }

    // hook methods don't need to be public
    @Hook
    private void example(ExampleEvent e) {
        // run code here
    }
<span class="boring">}
</span></code></pre>
<h2><a class="header" href="#advanced-eventshooks" id="advanced-eventshooks">Advanced events/hooks</a></h2>
<h3><a class="header" href="#hook-options" id="hook-options">Hook options</a></h3>
<p>Similarly to Forge event hooks, Etcetera event hooks can have a priority and can request to still 
recieve canceled events. The priority and <code>receiveCanceled</code> flag can be passed to the <code>hook</code> method
or in the <code>@Hook</code> annotation, as the case may be. The priority is useful for canceling events, since
you can request for your event to run before others.</p>
<h3><a class="header" href="#per-hook-state" id="per-hook-state">Per-hook state</a></h3>
<p>Each individual event hook can hold some state, and your event can act on that by overriding the
<code>storePerHookState</code> and <code>loadPerHookState</code> methods. Whatever value was returned from
<code>storePerHookState</code> is passed to <code>loadPerHookState</code> the next time <em>that hook</em> is called, meaning
each individual hook can have independent state.</p>
<pre><code class="language-java"><span class="boring">import com.teamwizardry.librarianlib.etcetera.eventbus.Event;
</span><span class="boring">import org.jetbrains.annotations.Nullable;
</span><span class="boring">
</span>public class ExampleEventState extends Event {
    public final int delta;
    public int accumulator;

    public ExampleEventState(int delta) {
        this.delta = delta;
    }

    @Override
    protected void loadPerHookState(@Nullable Object state) {
        if(state != null) {
            accumulator = (Integer)state;
        } else {
            accumulator = 0;
        }
        accumulator += delta;
    }

    @Nullable
    @Override
    protected Object storePerHookState() {
        return accumulator;
    }
}
</code></pre>
<pre><code class="language-java"><span class="boring">import com.teamwizardry.librarianlib.etcetera.eventbus.Hook;
</span><span class="boring">
</span><span class="boring">public class ExampleHooks {
</span><span class="boring">   public void autoHook() {
</span><span class="boring">       BUS.register(this);
</span><span class="boring">   }
</span><span class="boring">
</span>    // this will run every 100 &quot;units&quot; of delta. This is useful for mouse
    // scroll events, where lots of little deltas should add up to one step
    @Hook
    private void example(ExampleEventState e) {
        while(e.accumulator &gt;= 100) {
            e.accumulator -= 100;
            // do the thing
        }
    }
<span class="boring">}
</span></code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../etcetera/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../prism/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../etcetera/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../prism/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        
        <!-- Livereload script (if served using the cli tool) -->
        <script type="text/javascript">
            var socket = new WebSocket("ws://localhost:3000/__livereload");
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>
        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
